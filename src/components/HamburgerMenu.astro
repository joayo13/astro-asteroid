---
import { LINKS } from '@consts';
import '../styles/hamburger.css';
import slugify from '@utils/slugify';
---

<label class="hamburger-menu flex md:hidden">
    <input type="checkbox" />
</label>

<nav id="mobile-nav-links" class="fixed inset-0 right-0 mt-[var(--h-header)]">
    <div
        id="mobile-nav-underlay"
        class="fixed duration-300 ease-in-out block bg-neutral opacity-0 inset-0 z-10 mt-[var(--h-header)] pointer-events-none"
    >
    </div>
    <ul
        id="mobile-nav-overlay"
        class="fixed menu gap-4 duration-300 translate-x-full ease-in-out bg-base-200 z-20 right-0 w-1/2 h-full"
    >
        {
            LINKS.map((link) =>
                link.SUBLINKS ? (
                    <li>
                        <details>
                            <summary>{link.TITLE}</summary>
                            <ul class="p-2">
                                {link.SUBLINKS.map((sublink) => (
                                    <li class="mt-4">
                                        <a href={slugify(sublink.TITLE)}>
                                            {sublink.TITLE}
                                        </a>
                                    </li>
                                ))}
                            </ul>
                        </details>
                    </li>
                ) : (
                    <li>
                        <a href={slugify(link.TITLE)}>{link.TITLE}</a>
                    </li>
                )
            )
        }
        <div class="h-px w-full bg-base-content"></div>
    </ul>
</nav>

<script>
    const hamburger = document.querySelector(
        '.hamburger-menu input'
    ) as HTMLInputElement;
    const mobileMenuOverlay = document.querySelector(
        '#mobile-nav-overlay'
    ) as HTMLElement;
    const mobileMenuUnderlay = document.querySelector(
        '#mobile-nav-underlay'
    ) as HTMLElement;

    const toggleMobileMenu = () => {
        if (mobileMenuOverlay.classList.contains('translate-x-0')) {
            mobileMenuOverlay.classList.remove('no-doc-scroll');
            mobileMenuOverlay.classList.add('translate-x-full');
            mobileMenuOverlay.classList.remove('translate-x-0');
            mobileMenuUnderlay.classList.add('opacity-0');
            mobileMenuUnderlay.classList.remove('opacity-50');
        } else {
            mobileMenuOverlay.classList.add('no-doc-scroll');
            mobileMenuOverlay.classList.remove('translate-x-full');
            mobileMenuOverlay.classList.add('translate-x-0');
            mobileMenuUnderlay.classList.remove('opacity-0');
            mobileMenuUnderlay.classList.add('opacity-50');
        }
    };

    hamburger.addEventListener('click', toggleMobileMenu);
    const mobileLinks = document.querySelectorAll('#mobile-link');
    mobileLinks.forEach((link) => {
        link.addEventListener('click', () => {
            toggleMobileMenu();
        });
    });
</script>

<script is:inline>
    let lastScroll = 0;
    const nav = document.querySelector('.navbar');
    if (screen.width < 1028)
        window.addEventListener('scroll', () => {
            const currentScroll = window.pageYOffset;

            if (currentScroll > lastScroll && currentScroll > 100) {
                // scrolling down
                nav?.classList.add('translate-y-[-100%]');
            } else {
                // scrolling up
                nav?.classList.remove('translate-y-[-100%]');
            }

            lastScroll = currentScroll;
        });
</script>
